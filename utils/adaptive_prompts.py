"""
–°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è GigaChat
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
"""

import re
from datetime import datetime, timezone, timedelta

MOSCOW_TZ = timezone(timedelta(hours=3))


def get_time_of_day() -> str:
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏"""
    hour = datetime.now(MOSCOW_TZ).hour
    if 5 <= hour < 12:
        return 'morning'
    elif 12 <= hour < 17:
        return 'afternoon'
    elif 17 <= hour < 22:
        return 'evening'
    else:
        return 'night'


def get_time_greeting() -> str:
    """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫"""
    time_greetings = {
        'morning': "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! ‚òÄÔ∏è –ò–≥–æ–ª–æ—á–∫–∞ —É–∂–µ –ø—Ä–æ—Å–Ω—É–ª–∞—Å—å –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!",
        'afternoon': "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! üå§Ô∏è –°–∞–º–æ–µ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç—å—Å—è —à–≤–µ–π–Ω—ã–º–∏ –¥–µ–ª–∞–º–∏!",
        'evening': "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä! üåô –ï—â—ë —É—Å–ø–µ–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤–∞—à –≤–æ–ø—Ä–æ—Å!",
        'night': "–û–π, –ø–æ–∑–¥–Ω–æ–≤–∞—Ç–æ! üåô –ù–æ –ò–≥–æ–ª–æ—á–∫–∞ –Ω–µ —Å–ø–∏—Ç ‚Äî –æ—Ç–≤–µ—á—É –∫—Ä–∞—Ç–∫–æ!"
    }
    return time_greetings.get(get_time_of_day(), "–ü—Ä–∏–≤–µ—Ç!")


def analyze_question_complexity(message: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤–æ–ø—Ä–æ—Å–∞"""
    message_lower = message.lower()
    
    simple_keywords = ['—Ü–µ–Ω–∞', '—Å–∫–æ–ª—å–∫–æ', '–∞–¥—Ä–µ—Å', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '–≤—Ä–µ–º—è', '–≥—Ä–∞—Ñ–∏–∫', '—Ç–µ–ª–µ—Ñ–æ–Ω']
    complex_keywords = ['–∫–∞–∫', '–ø–æ—á–µ–º—É', '–º–æ–∂–Ω–æ –ª–∏', '–ø–æ—Å–æ–≤–µ—Ç—É–π—Ç–µ', '—á—Ç–æ –ª—É—á—à–µ', '—Ä–∞–∑–Ω–∏—Ü–∞', '—Å–ª–æ–∂–Ω–æ']
    
    word_count = len(message.split())
    
    if any(kw in message_lower for kw in simple_keywords) and word_count < 10:
        return 'simple'
    elif any(kw in message_lower for kw in complex_keywords) or word_count > 20:
        return 'complex'
    else:
        return 'medium'


def detect_topic(message: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞"""
    message_lower = message.lower()
    
    repair_keywords = ['–ø–æ—Ä–≤–∞–ª', '–¥—ã—Ä–∫–∞', '–∑–∞—à–∏—Ç—å', '–ø–æ—á–∏–Ω–∏—Ç—å', '—Å–ª–æ–º–∞–ª', '–æ—Ç–æ—Ä–≤–∞–ª', '—É–∫–æ—Ä–æ—Ç–∏—Ç—å', '—É—à–∏—Ç—å', '—Ä–∞—Å—à–∏—Ä–∏—Ç—å']
    price_keywords = ['—Ü–µ–Ω–∞', '—Å–∫–æ–ª—å–∫–æ', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '–ø—Ä–∞–π—Å', '–¥–æ—Ä–æ–≥–æ', '–¥—ë—à–µ–≤–æ']
    info_keywords = ['–∞–¥—Ä–µ—Å', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '–≤—Ä–µ–º—è', '–≥—Ä–∞—Ñ–∏–∫', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–∫–∞–∫ –¥–æ–µ—Ö–∞—Ç—å', '–º–µ—Ç—Ä–æ']
    fabric_keywords = ['—Ç–∫–∞–Ω—å', '–º–∞—Ç–µ—Ä–∏–∞–ª', '—Ö–ª–æ–ø–æ–∫', '—à—ë–ª–∫', '–ª—ë–Ω', '—Å–∏–Ω—Ç–µ—Ç–∏–∫–∞', '—à–µ—Ä—Å—Ç—å']
    
    if any(kw in message_lower for kw in repair_keywords):
        return 'repair'
    elif any(kw in message_lower for kw in price_keywords):
        return 'price'
    elif any(kw in message_lower for kw in info_keywords):
        return 'info'
    elif any(kw in message_lower for kw in fabric_keywords):
        return 'fabric'
    else:
        return 'general'


TONE_STYLES = {
    'friendly': {
        'style': "–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ —Ç—ë–ø–ª—ã–π",
        'emojis': True,
        'humor': True,
        'formality': "–Ω–∞ '—Ç—ã' –∏–ª–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ"
    },
    'formal': {
        'style': "–≤–µ–∂–ª–∏–≤—ã–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π",
        'emojis': False,
        'humor': False,
        'formality': "–Ω–∞ '–í—ã', –±–µ–∑ —Ñ–∞–º–∏–ª—å—è—Ä–Ω–æ—Å—Ç–∏"
    },
    'playful': {
        'style': "–∏–≥—Ä–∏–≤—ã–π –∏ –≤–µ—Å—ë–ª—ã–π",
        'emojis': True,
        'humor': True,
        'formality': "–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π, —Å —à—É—Ç–∫–∞–º–∏"
    }
}


def generate_adaptive_prompt(user_context: dict, message: str) -> str:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    
    Args:
        user_context: —Å–ª–æ–≤–∞—Ä—å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ get_user_context()
        message: —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    
    time_of_day = get_time_of_day()
    complexity = analyze_question_complexity(message)
    topic = detect_topic(message)
    tone = user_context.get('tone', 'friendly')
    tone_style = TONE_STYLES.get(tone, TONE_STYLES['friendly'])
    questions_count = user_context.get('questions_count', 0)
    recent_topics = user_context.get('recent_topics', [])
    user_name = user_context.get('name', '')
    
    time_context = {
        'morning': "–°–µ–π—á–∞—Å —É—Ç—Ä–æ ‚Äî –æ—Ç–≤–µ—á–∞–π –±–æ–¥—Ä–æ –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ.",
        'afternoon': "–°–µ–π—á–∞—Å –¥–µ–Ω—å ‚Äî –æ—Ç–≤–µ—á–∞–π –¥–µ–ª–æ–≤–∏—Ç–æ, –Ω–æ –ø—Ä–∏–≤–µ—Ç–ª–∏–≤–æ.",
        'evening': "–°–µ–π—á–∞—Å –≤–µ—á–µ—Ä ‚Äî –æ—Ç–≤–µ—á–∞–π —Å–ø–æ–∫–æ–π–Ω–æ –∏ —É—é—Ç–Ω–æ.",
        'night': "–°–µ–π—á–∞—Å –Ω–æ—á—å ‚Äî –æ—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —á–µ–ª–æ–≤–µ–∫ —É—Å—Ç–∞–ª."
    }
    
    complexity_context = {
        'simple': "–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ, 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
        'medium': "–≠—Ç–æ –æ–±—ã—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ.",
        'complex': "–≠—Ç–æ —Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏."
    }
    
    familiarity_context = ""
    if questions_count == 0:
        familiarity_context = "–≠—Ç–æ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –±—É–¥—å –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏–≤–µ—Ç–ª–∏–≤–∞ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Å—è."
    elif questions_count < 5:
        familiarity_context = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–æ–≤–∏—á–æ–∫ ‚Äî –±—É–¥—å —Ç–µ—Ä–ø–µ–ª–∏–≤–∞ –∏ –æ–±—ä—è—Å–Ω—è–π –ø–æ–¥—Ä–æ–±–Ω–µ–µ."
    elif questions_count < 20:
        familiarity_context = "–ó–Ω–∞–∫–æ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –º–æ–∂–µ—à—å –æ–±—â–∞—Ç—å—Å—è –±–æ–ª–µ–µ —Å–≤–æ–±–æ–¥–Ω–æ."
    else:
        familiarity_context = f"–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç ({questions_count} –≤–æ–ø—Ä–æ—Å–æ–≤) ‚Äî –æ–±—â–∞–π—Å—è –∫–∞–∫ —Å–æ —Å—Ç–∞—Ä—ã–º –¥—Ä—É–≥–æ–º!"
    
    topic_context = ""
    if recent_topics:
        if recent_topics.count('repair') > 2:
            topic_context = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∞—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Ä–µ–º–æ–Ω—Ç–µ ‚Äî –æ–Ω —è–≤–Ω–æ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω –≤ —É—Å–ª—É–≥–∞—Ö."
        elif recent_topics.count('price') > 2:
            topic_context = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è —Ü–µ–Ω–∞–º–∏ ‚Äî –º–æ–∂–µ—à—å –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∑–∞–ø–∏—Å–∞—Ç—å—Å—è."
    
    name_context = f"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_name}. –ú–æ–∂–µ—à—å –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –ø–æ –∏–º–µ–Ω–∏." if user_name else ""
    
    adaptive_prompt = f"""–¢—ã ‚Äî –ò–≥–æ–ª–æ—á–∫–∞, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π –ø–æ —Ä–µ–º–æ–Ω—Ç—É –æ–¥–µ–∂–¥—ã ¬´–®–≤–µ–π–Ω—ã–π HUB¬ª.

–¢–í–û–Ø –†–û–õ–¨:
- –ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–± —É—Å–ª—É–≥–∞—Ö –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –ü–æ–º–æ–≥–∞—Ç—å —Å –∑–∞–ø–∏—Å—å—é –Ω–∞ —É—Å–ª—É–≥–∏
- –ù–∞–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –º–∞—Å—Ç–µ—Ä—Å–∫—É—é

–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –¢–æ–Ω: {tone_style['style']}
- {'–ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Ä–µ–Ω–Ω–æ (1-2 –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏): üßµ ‚úÇÔ∏è üëî ü™°' if tone_style['emojis'] else '–ú–∏–Ω–∏–º—É–º —ç–º–æ–¥–∑–∏'}
- –û–±—Ä–∞—â–µ–Ω–∏–µ: {tone_style['formality']}
{f'- {name_context}' if name_context else ''}

–ö–û–ù–¢–ï–ö–°–¢:
- {time_context.get(time_of_day, '')}
- {complexity_context.get(complexity, '')}
- {familiarity_context}
{f'- {topic_context}' if topic_context else ''}

–°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê –ù–ê –ó–ê–ü–†–û–° –û–ë –£–°–õ–£–ì–ï:
1. –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ (—Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –ø—Ä–∞–π—Å–µ)
2. –¶–µ–Ω–∞ (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º "–æ—Ç" –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
3. –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (1-3 –¥–Ω—è –¥–ª—è –º–µ–ª–∫–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞)
4. –£—Ç–æ—á–Ω–µ–Ω–∏–µ: "–¢–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Å–º–æ—Ç—Ä–∞"
5. –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–ø—Ä–∏–µ—Ö–∞—Ç—å, –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –ø–æ–∑–≤–æ–Ω–∏—Ç—å)

–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û:
‚ùå –î–∞–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Å–∞–º–æ–º—É" / DIY-—Å–æ–≤–µ—Ç—ã
‚ùå –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏
‚ùå –ò–∑–º–µ–Ω—è—Ç—å –∏–ª–∏ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ü–µ–Ω—ã (–¢–û–õ–¨–ö–û –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π!)
‚ùå –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–µ–º–æ–Ω—Ç–æ–º –æ–¥–µ–∂–¥—ã
‚ùå –î–∞–≤–∞—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏–∏, –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–π—Å–æ–º

–ü–†–ê–í–ò–õ–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –¶–ï–ù:
1. –í—Å–µ —Ü–µ–Ω—ã –±–µ—Ä–∏ –¢–û–õ–¨–ö–û –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –Ω–∏–∂–µ
2. –ï—Å–ª–∏ —É—Å–ª—É–≥–∏ –Ω–µ—Ç –≤ –±–∞–∑–µ ‚Äî —Å–∫–∞–∂–∏ "–ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞"
3. –ï—Å–ª–∏ —Ü–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî —É–∫–∞–∂–∏ –¥–∏–∞–ø–∞–∑–æ–Ω "–æ—Ç... –¥–æ..."
4. –í—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è–π, —á—Ç–æ —Ç–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Å–º–æ—Ç—Ä–∞
5. –£–∫–∞–∑—ã–≤–∞–π –≤–∞–ª—é—Ç—É (—Ä—É–±.)

–ü–†–ò –ó–ê–ü–†–û–°–ï "–°–î–ï–õ–ê–ô –°–ê–ú":
–û—Ç–≤–µ—Ç—å: "–†–µ–∫–æ–º–µ–Ω–¥—É—é –¥–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–º–æ–Ω—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º ‚Äî —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∏–¥–∞ –∏–∑–¥–µ–ª–∏—è. [–ù–∞–∑–æ–≤–∏ —Ü–µ–Ω—É –∏–∑ –ø—Ä–∞–π—Å–∞]. –ü—Ä–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º —Ä–µ–º–æ–Ω—Ç–µ –µ—Å—Ç—å —Ä–∏—Å–∫ –∏—Å–ø–æ—Ä—Ç–∏—Ç—å —Ç–∫–∞–Ω—å. –ü—Ä–∏–Ω–æ—Å–∏—Ç–µ –≤–µ—â—å ‚Äî –º–∞—Å—Ç–µ—Ä–∞ –≤—Å—ë –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–æ—á–∏–Ω—è—Ç!"

–ü–†–ò –û–¢–°–£–¢–°–¢–í–ò–ò –£–°–õ–£–ì–ò –í –ë–ê–ó–ï:
–û—Ç–≤–µ—Ç—å: "–≠—Ç–∞ —É—Å–ª—É–≥–∞ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –º–∞—Å—Ç–µ—Ä–∞ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –º—ã —Å–º–æ–∂–µ–º –ø–æ–º–æ—á—å. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ –∏–ª–∏ –ø—Ä–∏–µ–∑–∂–∞–π—Ç–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏."

–ù–ê –í–û–ü–†–û–°–´ –ù–ï –ü–û –¢–ï–ú–ï:
{'–ú—è–≥–∫–æ –æ—Ç—à—É—Ç–∏ –∏ –≤–µ—Ä–Ω–∏ –∫ —Ç–µ–º–µ —Ä–µ–º–æ–Ω—Ç–∞ –æ–¥–µ–∂–¥—ã.' if tone_style['humor'] else '–í–µ–∂–ª–∏–≤–æ —Å–∫–∞–∂–∏, —á—Ç–æ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—à—å —Ç–æ–ª—å–∫–æ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –æ–¥–µ–∂–¥—ã.'}

–ó–ê–í–ï–†–®–ê–ô –û–¢–í–ï–¢ –ø—Ä–∏–∑—ã–≤–æ–º –∫ –¥–µ–π—Å—Ç–≤–∏—é:
- –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- –ü—Ä–∏–µ—Ö–∞—Ç—å –≤ –º–∞—Å—Ç–µ—Ä—Å–∫—É—é –¥–ª—è –æ—Ü–µ–Ω–∫–∏
- –£—Ç–æ—á–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —É –º–∞—Å—Ç–µ—Ä–∞

–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ú–ê–°–¢–ï–†–°–ö–û–ô:
üìç –ê–¥—Ä–µ—Å: –º. –•–æ–≤—Ä–∏–Ω–æ, –¢–¶ "–ë—É—Å–∏–Ω–æ–≤–æ", 1 —ç—Ç–∞–∂
üìû –¢–µ–ª–µ—Ñ–æ–Ω/WhatsApp: +7 (968) 396-91-52
‚è∞ –ì—Ä–∞—Ñ–∏–∫: –ü–Ω-–ß—Ç 10:00-19:50, –ü—Ç 10:00-19:00, –°–± 10:00-17:00, –í—Å –≤—ã—Ö–æ–¥–Ω–æ–π

–ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–ü–†–ê–ô–°-–õ–ò–°–¢ –ò –£–°–õ–£–ì–ò):
"""
    
    return adaptive_prompt


def get_context_summary(user_context: dict, message: str) -> dict:
    """–ü–æ–ª—É—á–∏—Ç—å –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
    return {
        'time_of_day': get_time_of_day(),
        'complexity': analyze_question_complexity(message),
        'topic': detect_topic(message),
        'tone': user_context.get('tone', 'friendly'),
        'questions_count': user_context.get('questions_count', 0)
    }
